<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>🏦 Credibe - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="../favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/vanilla-tilt@1.7.0/dist/vanilla-tilt.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>

   <style>
    body {
        font-family: 'Poppins', sans-serif;
    }

    .skeleton {
        animation: pulse 1.5s infinite ease-in-out;
        background-color: #2d2d2d;
        height: 1.5rem;
        border-radius: 0.25rem;
    }

    .chart-container {
        animation: fadeIn 1s ease-in-out;
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .mobile-menu {
        transition: transform 0.3s ease-in-out;
    }

    .mobile-menu.open {
        transform: translateX(0);
    }

    .mobile-menu.closed {
        transform: translateX(-100%);
    }

    .fade-in {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease, transform 0.6s ease;
    }

    .fade-in.visible {
        opacity: 1;
        transform: translateY(0);
    }

    .gradient-border {
        border: 2px solid transparent;
        background: linear-gradient(45deg, #00b4d8, #00d4ff, #00b4d8) border-box;
        background-size: 200%;
        animation: gradientShift 3s ease infinite;
    }

    .gradient-border:hover {
        background: linear-gradient(45deg, #00d4ff, #00b4d8, #00d4ff) border-box;
    }

    @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
    }

    .map-path { 
        fill: #2d2d2d; 
    }

    input:focus + span, select:focus + span { 
        opacity: 1 !important; 
    }

    /* Header Enhancements */
    .header {
        transition: background-color 0.3s ease;
    }

    .header:hover {
        background-color: #3a3a3a;
    }

    .greeting {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .greeting:hover {
        transform: scale(1.05);
        opacity: 0.9;
    }

    /* Mobile Greeting (Simplified) */
    @media (max-width: 767px) {
        .header .greeting {
            display: none;
        }
        .header::after {
            content: "👋 Member";
            display: block;
            text-align: center;
            font-size: 0.9rem;
            color: #bbb;
            padding-top: 0.5rem;
        }
    }
</style>
</head>
<body class="bg-[#1a1a1a] text-[#e0e0e0] min-h-screen flex flex-col overflow-x-hidden">
  <!-- Header with Logo, Welcome Text, and Menu Toggle -->
  <header class="bg-[#2d2d2d] p-3 sm:p-6 flex items-center justify-between sticky top-0 z-50 w-full shadow-md">
    <div class="flex items-center space-x-4">
        <a href="index.html" class="text-2xl sm:text-3xl font-bold text-[#00b4d8] flex items-center">
            🏦 <span class="ml-1">Credibe</span>
        </a>
        <div class="hidden sm:flex items-center space-x-2">
            <span class="text-white text-base sm:text-lg font-medium bg-[#1e1f2a] px-3 py-1 rounded-full">👋 Welcome back</span>
        </div>
    </div>
    <button id="menu-toggle" class="text-white text-2xl md:hidden focus:outline-none">
        ☰
    </button>
  </header>

    <!-- Main Layout -->
    <div class="flex flex-1 w-full">
        <!-- Sidebar Navigation (PC Only) -->
        <aside class="fixed top-[4rem] left-0 h-[calc(100vh-4rem)] bg-[#2d2d2d] w-64 p-2 sm:p-4 space-y-2 hidden md:block z-30">
            <nav>
                <a href="#" data-page="dashboard" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">🏠 Dashboard</a>
                <a href="#" data-page="accounts" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">💳 Accounts</a>
                <a href="#" data-page="transfers" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">💸 Transfers</a>
                <a href="#" data-page="transactions" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">📄 Transactions</a>
                <a href="#" data-page="analytics" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">📊 Analytics</a>
                <a href="#" data-page="security" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">🔒 Security</a>
                <a href="#" data-page="settings" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">⚙️ Settings</a>
            </nav>
        </aside>

        <!-- Mobile Menu -->
        <nav id="mobile-menu" class="fixed top-[4rem] left-0 w-64 bg-[#2d2d2d] h-full p-2 space-y-2 transform transition-transform duration-300 ease-in-out md:hidden z-40 mobile-menu closed">
            <a href="#" data-page="dashboard" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">🏠 Dashboard</a>
            <a href="#" data-page="accounts" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">💳 Accounts</a>
            <a href="#" data-page="transfers" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">💸 Transfers</a>
            <a href="#" data-page="transactions" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">📄 Transactions</a>
            <a href="#" data-page="analytics" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">📊 Analytics</a>
            <a href="#" data-page="security" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">🔒 Security</a>
            <a href="#" data-page="settings" class="nav-link block p-1 sm:p-2 rounded-lg hover:bg-[#3a3a3a] hover:text-[#00b4d8] transition duration-300 ease-in-out flex items-center gap-1 sm:gap-2 text-sm sm:text-base">⚙️ Settings</a>
        </nav>

        <!-- Main Content Area -->
        <main class="flex-1 p-2 sm:p-4 w-full md:ml-64">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page">
                <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Dashboard</h1>
                <div x-data="{ loading: false }" class="space-y-2 sm:space-y-4">
                    <div x-show="loading" class="grid grid-cols-1 gap-2 sm:gap-4">
                        <div class="skeleton h-16 sm:h-24"></div>
                        <div class="skeleton h-16 sm:h-24"></div>
                        <div class="skeleton h-16 sm:h-24"></div>
                    </div>
                   <div x-show="!loading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-4">
  <!-- Total Balance -->
  <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md hover:scale-105 transition duration-300 ease-in-out">
    <a href="add-money.html" class="block flex flex-col">
      <span class="text-xl sm:text-3xl">💰</span>
      <h3 class="text-[#e0e0e0] font-semibold mt-1 sm:mt-2 text-sm sm:text-base">Total Balance</h3>
      <p id="totalBalance" class="text-[#00b4d8] text-base sm:text-xl">€0.00</p>
    </a>
  </div>

  <!-- Savings -->
  <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md hover:scale-105 transition duration-300 ease-in-out">
    <span class="text-xl sm:text-3xl">🏦</span>
    <h3 class="text-[#e0e0e0] font-semibold mt-1 sm:mt-2 text-sm sm:text-base">Savings</h3>
    <p id="savingsAmount" class="text-[#00b4d8] text-base sm:text-xl">€0.00</p>
  </div>

  <!-- Credit -->
  <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md hover:scale-105 transition duration-300 ease-in-out">
    <span class="text-xl sm:text-3xl">💳</span>
    <h3 class="text-[#e0e0e0] font-semibold mt-1 sm:mt-2 text-sm sm:text-base">Credit</h3>
    <p id="creditAmount" class="text-[#00b4d8] text-base sm:text-xl">€0.00</p>
  </div>
</div>
          <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md chart-container">
                        <h2 class="text-lg sm:text-xl font-semibold text-[#e0e0e0] mb-1 sm:mb-4">Spending Overview</h2>
                        <div class="w-full h-32 sm:h-60 md:max-h-80">
                            <canvas id="spending-chart"></canvas>
                        </div>
                    </div>
                    <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md">
                        <h2 class="text-white text-base sm:text-lg font-semibold px-2 sm:px-4 mb-1 sm:mb-2">Quick Actions</h2>
                        <section class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2 sm:gap-4 px-2 sm:px-4 py-2 sm:py-4">
                            <div>
                                <a href="down.html" class="block w-full h-full">
                                    <div class="flex flex-col items-center justify-center bg-gray-800 text-white rounded-lg sm:rounded-xl p-2 shadow hover:bg-gray-700 transition min-w-0">
                                        <span class="text-lg sm:text-xl">💱</span>
                                        <span class="mt-1 text-xs sm:text-sm text-center">Buy Crypto</span>
                                    </div>
                                </a>
                            </div>
                            <div>
                                <a href="down.html" class="block w-full h-full">
                                    <div class="flex flex-col items-center justify-center bg-gray-800 text-white rounded-lg sm:rounded-xl p-2 shadow hover:bg-gray-700 transition min-w-0">
                                        <span class="text-lg sm:text-xl">💵</span>
                                        <span class="mt-1 text-xs sm:text-sm text-center">Pay Bills</span>
                                    </div>
                                </a>
                            </div>
                            <div>
                                <a href="down.html" class="block w-full h-full">
                                    <div class="flex flex-col items-center justify-center bg-gray-800 text-white rounded-lg sm:rounded-xl p-2 shadow hover:bg-gray-700 transition min-w-0">
                                        <span class="text-lg sm:text-xl">👤</span>
                                        <span class="mt-1 text-xs sm:text-sm text-center">Add Beneficiary</span>
                                    </div>
                                </a>
                            </div>
                            <div>
                                <a href="add-money.html" class="block w-full h-full">
                                    <div class="flex flex-col items-center justify-center bg-gray-800 text-white rounded-lg sm:rounded-xl p-2 shadow hover:bg-gray-700 transition min-w-0">
                                        <span class="text-lg sm:text-xl">💳</span>
                                        <span class="mt-1 text-xs sm:text-sm text-center">Receive Money</span>
                                    </div>
                                </a>
                            </div>
                        </section>
                    </div>
                </div>
            </div>

            <!-- Accounts Page -->
            <div id="accounts-page" class="page hidden">
                <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Accounts</h1>
                <div x-data="{ loading: false }" class="space-y-2 sm:space-y-6">
                    <div x-show="loading" class="grid grid-cols-1 gap-2 sm:gap-4">
                        <div class="skeleton h-24 sm:h-32"></div>
                        <div class="skeleton h-24 sm:h-32"></div>
                    </div>
                    <div x-show="!loading" class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4">
                        <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md hover:scale-105 transition duration-300 ease-in-out">
                            <h3 class="text-lg sm:text-xl font-semibold text-[#e0e0e0] mb-1 sm:mb-2">Checking Account</h3>
                            <p class="text-[#bbb] flex items-center gap-1 sm:gap-2 text-sm sm:text-base">🇧🇪 IBAN: BE68 5390 0754 7034</p>
                            <p class="text-[#bbb] text-sm sm:text-base">Created: 2024-01-15</p>
                            <span class="bg-green-500/20 text-green-400 px-1 sm:px-2 py-1 rounded text-xs sm:text-sm mt-1 sm:mt-2 inline-block">Active</span>
                        </div>
                        <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md hover:scale-105 transition duration-300 ease-in-out">
                            <h3 class="text-lg sm:text-xl font-semibold text-[#e0e0e0] mb-1 sm:mb-2">Savings Account</h3>
                            <p class="text-[#bbb] flex items-center gap-1 sm:gap-2 text-sm sm:text-base">🇳🇱 IBAN: NL91 ABNA 0417 1643 00</p>
                            <p class="text-[#bbb] text-sm sm:text-base">Created: 2023-06-20</p>
                            <span class="bg-green-500/20 text-green-400 px-1 sm:px-2 py-1 rounded text-xs sm:text-sm mt-1 sm:mt-2 inline-block">Active</span>
                        </div>
                    </div>
                </div>
            </div>

           <!-- Transfers Page -->
<div id="transfers-page" class="page hidden">
  <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Local Transfers (Europe)</h1>
  <div class="flex justify-center w-full">
    <form id="transfer-form" class="bg-[#1f2937]/50 backdrop-blur-md p-4 sm:p-6 rounded-lg sm:rounded-2xl shadow-md space-y-4 w-full max-w-md">

      <!-- Recipient Name -->
      <div>
        <label for="recipient-name" class="block text-sm text-[#e0e0e0]">Recipient Name</label>
        <input type="text" id="recipient-name" required class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter name">
      </div>

      <!-- User Email (OTP Destination) -->
      <div>
        <label for="user-email" class="block text-sm text-[#e0e0e0]">Your Email (OTP will be sent here)</label>
        <input type="email" id="user-email" required class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter your email for OTP">
      </div>

      <!-- Email (Optional) -->
<div>
  <label for="recipient-email" class="block text-sm text-[#e0e0e0]">Recipient Email (Optional)</label>
  <input type="email" id="recipient-email" class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter email (optional)">
</div>


      <!-- IBAN -->
      <div>
        <label for="recipient-iban" class="block text-sm text-[#e0e0e0]">Recipient IBAN</label>
        <input type="text" id="recipient-iban" required class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="e.g., BE68 5390 0754 7034">
      </div>

      <!-- Amount -->
      <div>
        <label for="amount" class="block text-sm text-[#e0e0e0]">Amount (€)</label>
        <input type="number" id="amount" required step="0.01" min="0.01" class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter amount">
      </div>

      <!-- Purpose -->
      <div>
        <label for="transfer-purpose" class="block text-sm text-[#e0e0e0]">Transfer Purpose</label>
        <select id="transfer-purpose" class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]">
          <option value="">Select purpose</option>
          <option value="rent">Rent</option>
          <option value="salary">Salary</option>
          <option value="gift">Gift</option>
          <option value="payment">Payment</option>
        </select>
      </div>

      <!-- Reference -->
      <div>
        <label for="reference" class="block text-sm text-[#e0e0e0]">Reference (Optional)</label>
        <input type="text" id="reference" class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter reference">
      </div>

      <!-- OTP Section -->
      <div id="transferOtpSection" class="hidden">
        <label for="transfer-otp" class="block text-sm text-[#e0e0e0]">One-Time Password (OTP)</label>
        <input type="text" id="transfer-otp" class="w-full bg-[#1a1a1a]/50 text-[#e0e0e0] border border-[#444] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter OTP">

        <div class="flex gap-2 mt-3">
          <button type="button" id="send-transfer-otp-phone" class="bg-[#00b4d8]/80 text-white px-4 py-2 rounded-lg hover:bg-[#00b4d8]">Send OTP to Phone</button>
          <button type="button" id="send-transfer-otp-email" class="bg-[#00b4d8]/80 text-white px-4 py-2 rounded-lg hover:bg-[#00b4d8]">Send OTP to Email</button>
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" id="submit-transfer" class="bg-[#00b4d8] text-white w-full rounded-lg px-4 py-2 text-sm flex items-center justify-center hover:bg-[#00b4d8]/90 transition">
        <span id="submitText">Send Now</span>
        <svg id="submitSpinner" class="hidden animate-spin h-4 w-4 ml-2 text-white" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
        </svg>
      </button>
    </form>
  </div>
</div>


            <!-- Transactions Page -->
            <div id="transactions-page" class="page hidden">
                <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Transactions</h1>
                <div x-data="{ loading: false }" class="space-y-2 sm:space-y-6">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-1 sm:mb-4 gap-2">
                        <h2 class="text-lg sm:text-xl font-semibold text-[#e0e0e0]">Past Transactions</h2>
                        <select id="transaction-filter" class="bg-[#3a3a3a] text-[#e0e0e0] border border-[#00b4d8] rounded-lg px-1 sm:px-3 py-1 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8] w-full sm:w-auto">
                            <option value="7">Last 7 Days</option>
                            <option value="30">Last 30 Days</option>
                            <option value="90">Last 90 Days</option>
                            <option value="all">All</option>
                        </select>
                        <button class="bg-red-600 hover:bg-red-700 text-white text-sm sm:text-base px-3 py-1 rounded-lg">Clear All</button>
                    </div>
                    <div x-show="loading" class="space-y-1 sm:space-y-2">
                        <div class="skeleton h-6 sm:h-8"></div>
                        <div class="skeleton h-6 sm:h-8"></div>
                        <div class="skeleton h-6 sm:h-8"></div>
                    </div>
                    <div x-show="!loading" class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="text-[#bbb]">
                                    <th class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Date</th>
                                    <th class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Recipient</th>
                                    <th class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Amount</th>
                                    <th class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Status</th>
                                </tr>
                            </thead>
                            <tbody id="transactions-table">
                                <!-- Populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div id="analytics-page" class="page hidden">
                <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Analytics</h1>
                <div x-data="{ loading: false }" class="space-y-2 sm:space-y-6">
                    <div x-show="loading" class="grid grid-cols-1 gap-2 sm:gap-4">
                        <div class="skeleton h-32 sm:h-60 md:h-80"></div>
                        <div class="skeleton h-32 sm:h-60 md:h-80"></div>
                    </div>
                    <div x-show="!loading" class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4">
                        <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md chart-container">
                            <h2 class="text-lg sm:text-xl font-semibold text-[#e0e0e0] mb-1 sm:mb-4">Monthly Spending</h2>
                            <div class="w-full h-32 sm:h-60 md:max-h-80">
                                <canvas id="monthly-spending-chart"></canvas>
                            </div>
                        </div>
                        <div class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md chart-container">
                            <h2 class="text-lg sm:text-xl font-semibold text-[#e0e0e0] mb-1 sm:mb-4">Spending by Category</h2>
                            <div class="w-full h-32 sm:h-60 md:max-h-80">
                                <canvas id="category-spending-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Page -->
            <div id="security-page" class="page hidden">
                <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Security</h1>
                <div class="flex justify-center w-full">
                    <div x-data="{ loading: false }" class="space-y-2 sm:space-y-6 max-w-xs sm:max-w-md w-full">
                        <div class="bg-[#1f2937] p-2 sm:p-4 sm:p-6 rounded-lg sm:rounded-2xl drop-shadow-md space-y-2 sm:space-y-4">
                            <div x-data="{ checked: false }" class="flex items-center justify-between">
                                <label class="text-[#e0e0e0] text-sm sm:text-base">Enable 2FA</label>
                                <input type="checkbox" id="enable-2fa" x-model="checked" class="bg-[#1a1a1a] border border-[#444] rounded focus:ring-[#00b4d8] transition duration-300" :class="{ 'ring-2 ring-[#00b4d8]': checked }">
                            </div>
                            <div x-data="{ checked: true }" class="flex items-center justify-between">
                                <label class="text-[#e0e0e0] text-sm sm:text-base">Show Last Login</label>
                                <input type="checkbox" id="show-last-login" x-model="checked" class="bg-[#1a1a1a] border border-[#444] rounded focus:ring-[#00b4d8] transition duration-300" :class="{ 'ring-2 ring-[#00b4d8]': checked }">
                            </div>
                            <button type="button" id="change-password" class="w-full bg-[#00b4d8] text-white rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base hover:opacity-90 transition duration-300 ease-in-out">Change Password</button>
                            <button type="button" id="verify-identity" class="w-full bg-[#00b4d8] text-white rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base hover:opacity-90 transition duration-300 ease-in-out">Verify Identity</button>
                        </div>
                        <div x-show="loading" class="space-y-1 sm:space-y-2">
                            <div class="skeleton h-6 sm:h-8"></div>
                            <div class="skeleton h-6 sm:h-8"></div>
                        </div>
                        <div x-show="!loading" class="bg-[#1f2937] p-2 sm:p-4 rounded-lg sm:rounded-2xl drop-shadow-md">
                            <h2 class="text-lg sm:text-xl font-semibold text-[#e0e0e0] mb-1 sm:mb-4">Login History</h2>
                            <table class="w-full text-left">
                                <thead>
                                    <tr class="text-[#bbb]">
                                        <th class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Date</th>
                                        <th class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Device</th>
                                        <th class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">IP Address</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-t border-[#444]">
                                        <td class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">2025-07-02 15:20</td>
                                        <td class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Chrome (Windows)</td>
                                        <td class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">192.168.1.1</td>
                                    </tr>
                                    <tr class="border-t border-[#444]">
                                        <td class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">2025-06-30 09:15</td>
                                        <td class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">Safari (iPhone)</td>
                                        <td class="p-1 sm:p-2 text-xs sm:text-sm sm:text-base">192.168.1.2</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <<!-- Settings Page -->
<div id="settings-page" class="page hidden">
  <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Settings</h1>
  <div class="flex justify-center w-full">
    <form id="settings-form" action="/settings" method="POST" class="bg-[#1f2937] p-2 sm:p-4 sm:p-6 rounded-lg sm:rounded-2xl drop-shadow-md space-y-2 sm:space-y-4 w-full max-w-xs sm:max-w-md">
      
      <div>
        <label for="full-name" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Full Name</label>
        <input type="text" id="full-name" name="full_name" class="w-full bg-[#1a1a1a] border border-[#444] text-[#e0e0e0] rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter full name" value="">
      </div>

      <div>
        <label for="email" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Email</label>
        <input type="email" id="email" name="email" class="w-full bg-[#1a1a1a] border border-[#444] text-[#e0e0e0] rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter email" value="">
      </div>

      <div>
        <label for="phone" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Phone</label>
        <input type="tel" id="phone" name="phone" class="w-full bg-[#1a1a1a] border border-[#444] text-[#e0e0e0] rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="+44 123 456 7890" value="">
      </div>

      <div>
        <label for="language" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Language</label>
        <select id="language" name="language" class="w-full bg-[#1a1a1a] border border-[#444] text-[#e0e0e0] rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]">
          <option value="en">English</option>
          <option value="fr">French</option>
          <option value="de">German</option>
        </select>
      </div>

      <div>
        <label for="timezone" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Time Zone</label>
        <select id="timezone" name="timezone" class="w-full bg-[#1a1a1a] border border-[#444] text-[#e0e0e0] rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]">
          <option value="UTC">UTC</option>
          <option value="CET">CET (UTC+1)</option>
        </select>
      </div>

      <a href="#" data-page="logout" class="w-full bg-[#00b4d8] text-white text-center rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base hover:opacity-90 transition duration-300 ease-in-out block">🚪 Logout</a>
      <button type="submit" class="w-full bg-[#00b4d8] text-white rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base hover:opacity-90 transition duration-300 ease-in-out">Save Changes</button>
    </form>
  </div>
</div>

            <!-- Logout Page -->
            <div id="logout-page" class="page hidden">
                <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Logout</h1>
                <div class="flex justify-center w-full">
                    <div class="bg-[#1f2937] p-2 sm:p-4 sm:p-6 rounded-lg sm:rounded-2xl drop-shadow-md max-w-xs sm:max-w-md w-full">
                        <p class="text-[#e0e0e0] mb-1 sm:mb-4 text-sm sm:text-base" id="logout-message">Are you sure you want to log out</p>
                        <button id="confirm-logout" class="w-full bg-[#00b4d8] text-white rounded-lg px-2 sm:px-4 py-1 sm:py-2 text-sm sm:text-base hover:opacity-90 transition duration-300 ease-in-out">Confirm Logout</button>
                    </div>
                </div>
            </div>

       <!-- Buy Crypto Page -->
<div id="buy-crypto-page" class="page hidden">
    <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Buy Crypto</h1>
    <form id="buy-crypto-form" action="down.html" method="get" class="bg-[#1f2937]/50 backdrop-blur-md p-2 sm:p-6 rounded-lg sm:rounded-2xl drop-shadow-md space-y-4 sm:space-y-6 w-full max-w-xs sm:max-w-md">
        <div class="relative">
            <label for="crypto-amount" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Amount (€)</label>
            <input type="number" id="crypto-amount" name="amount" step="0.01" min="0.01" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter amount" required>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">€</span>
        </div>
        <div class="relative">
            <label for="crypto-currency" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Currency</label>
            <select id="crypto-currency" name="currency" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]">
                <option value="BTC">Bitcoin (BTC)</option>
                <option value="ETH">Ethereum (ETH)</option>
            </select>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300">💰</span>
        </div>
        <div class="relative">
            <label for="wallet-address" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Wallet Address (Optional)</label>
            <input type="text" id="wallet-address" name="wallet_address" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter wallet address">
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">📍</span>
        </div>
        <button type="submit" id="submit-crypto" class="w-full bg-[#00b4d8] text-white rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base hover:bg-[#00b4d8]/90 transition-all flex items-center justify-center gradient-border">
            <span id="submit-text">Buy Now</span>
            <svg id="submit-spinner" class="hidden animate-spin h-3 sm:h-4 w-3 sm:w-4 mr-1 sm:mr-2 text-white" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </button>
        <div id="confirmation" class="hidden text-center text-green-400">
            <p>Transaction Successful!</p>
            <p>Tx Hash: <span id="tx-hash"></span></p>
        </div>
    </form>
</div>

<!-- Pay Bills Page -->
<div id="pay-bills-page" class="page hidden">
    <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Pay Bills</h1>
    <form id="pay-bills-form" action="down.html" method="get" class="bg-[#1f2937]/50 backdrop-blur-md p-2 sm:p-6 rounded-lg sm:rounded-2xl drop-shadow-md space-y-4 sm:space-y-6 w-full max-w-xs sm:max-w-md">
        <div class="relative">
            <label for="biller-name" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Biller Name</label>
            <input type="text" id="biller-name" name="biller_name" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter biller name" required>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">🏢</span>
        </div>
        <div class="relative">
            <label for="category" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Category</label>
            <select id="category" name="category" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]">
                <option value="utilities">Utilities</option>
                <option value="internet">Internet</option>
                <option value="rent">Rent</option>
            </select>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300">📋</span>
        </div>
        <div class="relative">
            <label for="bill-amount" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Amount (€)</label>
            <input type="number" id="bill-amount" name="amount" step="0.01" min="0.01" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter amount" required>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">€</span>
        </div>
        <div class="relative">
            <label for="description" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Description (Optional)</label>
            <input type="text" id="description" name="description" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter description">
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">📝</span>
        </div>
        <button type="submit" id="submit-bill" class="w-full bg-[#00b4d8] text-white rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base hover:bg-[#00b4d8]/90 transition-all flex items-center justify-center gradient-border">
            <span id="submit-text">Pay Now</span>
            <svg id="submit-spinner" class="hidden animate-spin h-3 sm:h-4 w-3 sm:w-4 mr-1 sm:mr-2 text-white" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </button>
        <div id="confirmation" class="hidden text-center text-green-400">
            <p>Payment Successful!</p>
        </div>
    </form>
</div>

<!-- Add Beneficiary Page -->
<div id="add-beneficiary-page" class="page hidden">
    <h1 class="text-2xl sm:text-3xl font-bold text-[#e0e0e0] mb-2 sm:mb-6">Add Beneficiary</h1>
    <form id="addBeneficiaryForm" action="down.html" method="get" class="bg-[#1f2937]/50 backdrop-blur-md p-2 sm:p-6 rounded-lg sm:rounded-2xl drop-shadow-md space-y-4 sm:space-y-6 w-full max-w-xs sm:max-w-md">
        <div class="relative">
            <label for="full-name" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Full Name</label>
            <input type="text" id="full-name" name="full_name" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter full name" required>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">👤</span>
        </div>
        <div class="relative">
            <label for="iban" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">IBAN</label>
            <input type="text" id="iban" name="iban" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="e.g., BE68 5390 0754 7034" required>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">🏦</span>
        </div>
        <div class="relative">
            <label for="bank-name" class="block text-[#e0e0e0] mb-1 sm:mb-2 text-sm sm:text-base">Bank Name</label>
            <input type="text" id="bank-name" name="bank_name" class="w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8]" placeholder="Enter bank name" required>
            <span class="absolute right-3 top-10 text-[#00b4d8] opacity-0 transition-opacity duration-300 focus-within:opacity-100">🏦</span>
        </div>
        <button type="submit" id="submit-beneficiary" class="w-full bg-[#00b4d8] text-white rounded-lg px-3 sm:px-4 py-2 text-sm sm:text-base hover:bg-[#00b4d8]/90 transition-all flex items-center justify-center gradient-border">
            <span id="submit-text">Add Beneficiary</span>
            <svg id="submit-spinner" class="hidden animate-spin h-3 sm:h-4 w-3 sm:w-4 mr-1 sm:mr-2 text-white" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        </button>
        <div id="confirmation" class="hidden text-center text-green-400">
            <p>Beneficiary Added Successfully!</p>
        </div>
    </form>
</div>

    <!-- Footer -->
  <footer class="bg-[#111] text-gray-400 text-xs text-center py-4 mt-auto">
    © 2025 Credibe. All rights reserved. | <a href="#">Privacy</a> | <a href="#">Terms</a> | <a href="#">Support</a>
  </footer>
  
<script>
(async () => {
function formatEuro(amount) {
  return `€${Number(amount).toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  })}`;
}

    // 🔐 Check for user token
const token = localStorage.getItem("userToken");
if (!token) {
    alert("You must be logged in to view this page.");
    window.location.href = "login.html";
}

    // Handle window resize to hide mobile menu on desktop
    window.addEventListener('resize', () => {
        if (window.innerWidth >= 768 && mobileMenu && !mobileMenu.classList.contains('closed')) {
            mobileMenu.classList.add('closed');
            mobileMenu.classList.remove('open');
            console.log('Mobile menu hidden on resize to desktop');
        }
    });

    // Page Switching with Skeleton Loader
    const navLinks = document.querySelectorAll('.nav-link');
    const pages = document.querySelectorAll('.page');

    function showPage(pageId) {
        pages.forEach(page => {
            page.classList.add('hidden');
            if (page.__x && page.__x.$data) {
                page.__x.$data.loading = true;
            }
        });

        const activePage = document.getElementById(`${pageId}-page`);
        if (activePage) {
            setTimeout(() => {
                activePage.classList.remove('hidden');
                if (activePage.__x && activePage.__x.$data) {
                    activePage.__x.$data.loading = false;
                }
                if (pageId === 'transactions') {
                    loadTransactions();
                }
            }, 500);
        }

        navLinks.forEach(link => link.classList.remove('bg-[#3a3a3a]', 'text-[#00b4d8]'));
        const activeLink = document.querySelector(`[data-page="${pageId}"]`);
        if (activeLink) activeLink.classList.add('bg-[#3a3a3a]', 'text-[#00b4d8]');

        if (window.innerWidth < 768 && mobileMenu) {
            mobileMenu.classList.add('closed');
            mobileMenu.classList.remove('open');
        }

        console.log(`Switched to page: ${pageId}`);
    }

    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const pageId = link.getAttribute('data-page');
            showPage(pageId);
        });
    });

    // Charts
    const spendingChartCtx = document.getElementById('spending-chart');
    if (spendingChartCtx) {
        try {
            new Chart(spendingChartCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Spending',
                        data: [1200, 1900, 1500, 2200, 1800, 2500],
                        borderColor: '#00b4d8',
                        backgroundColor: 'rgba(0, 180, 216, 0.2)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#00b4d8',
                        pointBorderColor: '#e0e0e0'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#e0e0e0', font: { size: 10 } }, grid: { color: '#444' } },
                        x: { ticks: { color: '#e0e0e0', font: { size: 10 } }, grid: { color: '#444' } }
                    },
                    plugins: { legend: { labels: { color: '#e0e0e0', font: { size: 12 } } } },
                    animation: { duration: 1000, easing: 'easeInOutQuad' }
                }
            });
            console.log('Spending chart initialized');
        } catch (error) {
            console.error('Error initializing spending chart:', error);
        }
    }

    const monthlySpendingChartCtx = document.getElementById('monthly-spending-chart');
    if (monthlySpendingChartCtx) {
        try {
            new Chart(monthlySpendingChartCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Monthly Spending',
                        data: [1000, 1500, 1200, 1800, 1600, 2000],
                        backgroundColor: '#00b4d8',
                        borderColor: '#e0e0e0',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, ticks: { color: '#e0e0e0', font: { size: 10 } }, grid: { color: '#444' } },
                        x: { ticks: { color: '#e0e0e0', font: { size: 10 } }, grid: { color: '#444' } }
                    },
                    plugins: { legend: { labels: { color: '#e0e0e0', font: { size: 12 } } } },
                    animation: { duration: 1000, easing: 'easeInOutQuad' }
                }
            });
            console.log('Monthly spending chart initialized');
        } catch (error) {
            console.error('Error initializing monthly spending chart:', error);
        }
    }

    const categorySpendingChartCtx = document.getElementById('category-spending-chart');
    if (categorySpendingChartCtx) {
        try {
            new Chart(categorySpendingChartCtx.getContext('2d'), {
                type: 'pie',
                data: {
                    labels: ['Groceries', 'Bills', 'Entertainment', 'Travel', 'Other'],
                    datasets: [{
                        data: [30, 25, 20, 15, 10],
                        backgroundColor: ['#00b4d8', '#87ceeb', '#4682b4', '#1e90ff', '#add8e6'],
                        borderColor: '#e0e0e0',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#e0e0e0', font: { size: 12 } } } },
                    animation: { duration: 1000, easing: 'easeInOutQuad' }
                }
            });
            console.log('Category spending chart initialized');
        } catch (error) {
            console.error('Error initializing category spending chart:', error);
        }
    }

// Transfer Form
const transferForm = document.getElementById('transfer-form');
const transferOtpSection = document.getElementById('transferOtpSection');
const sendTransferOtpPhone = document.getElementById('send-transfer-otp-phone');
const sendTransferOtpEmail = document.getElementById('send-transfer-otp-email');
const submitTransfer = document.getElementById('submit-transfer');
const submitText = document.getElementById('submit-text');
const submitSpinner = document.getElementById('submit-spinner');

if (transferForm) {
    const transferRecipientName = document.getElementById('recipient-name');
    const transferRecipientEmail = document.getElementById('recipient-email');
    const transferRecipientIban = document.getElementById('recipient-iban');

    // Load beneficiaries if available
    if (transferRecipientName && transferRecipientEmail && transferRecipientIban) {
        const beneficiaries = JSON.parse(localStorage.getItem('beneficiaries') || '[]');
        if (beneficiaries.length > 0) {
            const select = document.createElement('select');
            select.id = 'beneficiary-select';
            select.className = 'w-full bg-[#1a1a1a]/50 border border-[#444] text-[#e0e0e0] rounded-lg px-3 py-2 text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-[#00b4d8] mb-2';
            select.innerHTML = `<option value="">Select a beneficiary</option>` + 
                beneficiaries.map(b => `<option value="${b.email}">${b.fullName} (${b.email}, ${b.iban})</option>`).join('');
            transferRecipientName.parentElement.insertBefore(select, transferRecipientName);
            select.addEventListener('change', () => {
                const selected = beneficiaries.find(b => b.email === select.value);
                transferRecipientName.value = selected ? selected.fullName : '';
                transferRecipientEmail.value = selected ? selected.email : '';
                transferRecipientIban.value = selected ? selected.iban : '';
            });
        }
    }

    // 🔹 Send Transfer OTP to Your Own Email
    if (sendTransferOtpEmail) {
        sendTransferOtpEmail.addEventListener('click', async () => {
            const userEmailField = document.getElementById('user-email');
            if (!userEmailField) return alert("Your email input is missing.");

            const email = userEmailField.value.trim();
            if (!email) return alert("Please enter your email to receive OTP.");

            console.log('🧪 Sending OTP request:', { email, timestamp: new Date().toISOString() });

            if (transferOtpSection) transferOtpSection.classList.remove('hidden');

            try {
                const res = await fetch('https://credibe-backends.onrender.com/api/transfer/send-direct-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        type: "transfer"
                    })
                });

                const data = await res.json();
                console.log('🧪 OTP response:', { status: res.status, data });
                if (!res.ok) throw new Error(data.error || "OTP error");

                alert("OTP sent to your email ✔️");
            } catch (err) {
                console.error("❌ OTP send error:", err.message, { email });
                alert(err.message || "Something went wrong.");
            }
        });
    }

    // 🔹 Submit Transfer (CREDIBE IBAN-ONLY SYSTEM)
    transferForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const recipientName = document.getElementById('recipient-name').value.trim();
        const recipientIban = document.getElementById('recipient-iban').value.trim();
        const amount = parseFloat(document.getElementById('amount').value);
        const otp = document.getElementById('transfer-otp')?.value.trim();
        const purpose = document.getElementById('transfer-purpose').value || 'Transfer';
        const reference = document.getElementById('reference').value.trim();

        console.log("🧪 Submitting transfer:", {
            recipientIban,
            amount,
            otp,
            recipientName,
            purpose,
            reference,
            timestamp: new Date().toISOString()
        });

        const token = localStorage.getItem('userToken');

        console.log('🧪 Form data:', { recipientName, recipientIban, amount, purpose, reference, otp, hasToken: !!token });

        // ✅ Basic Validation
        if (!recipientName || !recipientIban || !amount) {
            console.log('🧪 Transfer validation failed: Missing fields');
            alert('Please fill all required fields.');
            return;
        }

        if (!/^[A-Z]{2}\d{2}\s?[A-Z0-9]{4}\s?[A-Z0-9]{4}\s?[A-Z0-9]{4}\s?[A-Z0-9]{0,16}$/.test(recipientIban.replace(/\s/g, ''))) {
            console.log('🧪 Transfer validation failed: Invalid IBAN', { recipientIban });
            alert('Please enter a valid IBAN (e.g., BE68539007547034).');
            return;
        }

        if (amount <= 0) {
            console.log('🧪 Transfer validation failed: Invalid amount', { amount });
            alert('Amount must be greater than 0.');
            return;
        }

        if (!transferOtpSection.classList.contains('hidden')) {
            if (!otp) {
                console.log('🧪 Transfer validation failed: Missing OTP');
                alert('Please enter the OTP sent to your email.');
                return;
            }

            // 🔄 Show loading state
            submitText.textContent = 'Processing...';
            submitSpinner.classList.remove('hidden');
            submitTransfer.disabled = true;

            try {
                const res = await fetch("https://credibe-backends.onrender.com/api/transfer/initiate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        Authorization: `Bearer ${localStorage.getItem("userToken")}`,
                    },
                    body: JSON.stringify({
                        toIban: recipientIban,
                        recipient: recipientName,
                        amount: parseFloat(amount),
                        note: reference || purpose,
                        otp
                    }),
                });

                const data = await res.json();
                console.log('🧪 Transfer response:', { status: res.status, data });

                if (res.ok && data.transactionId) {
                    alert('Transfer submitted successfully! (Pending approval)');
                    transferForm.reset();
                    transferOtpSection.classList.add('hidden');
                    submitText.textContent = 'Send Now';
                    submitSpinner.classList.add('hidden');
                    submitTransfer.disabled = false;

                    localStorage.setItem('pendingTransfer', JSON.stringify({
                        recipientName,
                        recipientIban,
                        amount,
                        purpose,
                        reference,
                        transferId: data.transactionId
                    }));

                    window.location.href = 'transfer-pending.html';
                } else {
                    console.log('🧪 Transfer failed:', { error: data.error, status: res.status });
                    alert(data.error || 'Transfer failed. Server responded with status: ' + res.status);
                }
            } catch (error) {
                console.error('❌ Transfer error:', error.message);
                alert('Something went wrong. Please try again later.');
            } finally {
                submitText.textContent = 'Send Now';
                submitSpinner.classList.add('hidden');
                submitTransfer.disabled = false;
            }
        } else {
            console.log('🧪 Transfer blocked: OTP section hidden');
            transferOtpSection.classList.remove('hidden');
            alert('Please request an OTP to proceed.');
        }
    });
}

// 🎯 Transaction Filter Dropdown
const transactionFilter = document.getElementById('transaction-filter');
if (transactionFilter) {
  transactionFilter.addEventListener('change', (e) => {
    const days = e.target.value || 'all';
    console.log('🧪 Filter selected:', days);
    loadTransactions(days);
    alert(`Filtered transactions for: ${days === 'all' ? 'All time' : `${days} days`}`);
  });
}

function generateStaticFakeTransactions() {
  const cached = localStorage.getItem('fakeTransactions');
  const freezeCap = new Date("2025-03-26T23:59:59");

  // 🧠 Check if cache exists AND is valid
  if (cached) {
    try {
      const parsed = JSON.parse(cached);

      const isValid = parsed.every(txn => {
        const d = new Date(txn.date);
        return txn.recipient && typeof txn.recipient === 'string' && d <= freezeCap;
      });

      if (isValid) return parsed;

      // 🧨 If invalid (e.g., future dates or unknowns) — delete it
      console.warn("🚫 Old or invalid fake txns found — clearing...");
      localStorage.removeItem('fakeTransactions');

    } catch (err) {
      console.warn("⚠️ Failed to parse fake txns — clearing...");
      localStorage.removeItem('fakeTransactions');
    }
  }

  // ✅ If no valid cache, generate new safe ones
  const names = [
    "ING Bank", "BNP Paribas", "Belfius", "KBC Group", "ABN AMRO",
    "Delhaize", "Albert Heijn", "Carrefour", "Colruyt", "Lidl Belgium",
    "Lucas Maes", "Emma Dupont", "Louis Vandamme", "Sophie Martin", "Julie Janssens",
    "Coolblue", "Vanden Borre", "Bol.com", "MediaMarkt", "Decathlon",
    "Zalando", "H&M", "IKEA Belgium", "JBC", "Tommy Hilfiger",
    "Esso", "TotalEnergies", "Q8 Belgium", "NMBS/SNCB", "De Lijn",
    "Stib-Mivb", "Bpost", "Telenet", "Proximus", "Orange Belgium",
    "Nestlé", "Unilever", "Coca-Cola EU", "Heineken", "Jupiler",
    "Dries Mertens", "Koen Wauters", "Noa Vermeer", "Charlotte Peeters", "Sarah De Smet",
    "Jens Van Damme", "Tom Vercauteren", "Kevin Leroy", "Lotte Nys", "Maxime Deneve"
  ];

  const txns = [];
  const fixedDate = new Date("2025-03-26T00:00:00Z");

  for (let i = 0; i < 100; i++) {
    const nameIndex = i % names.length;
    txns.push({
      _id: `fake-${i}`,
      date: fixedDate.toISOString(),
      recipient: names[nameIndex],
      amount: Math.floor(Math.random() * 900 + 100),
      status: "approved"
    });
  }

  localStorage.setItem('fakeTransactions', JSON.stringify(txns));
  return txns;
}


// ⏳ Filter transactions strictly by date
function filterTxnsByDays(txns, days) {
  const now = new Date();
  return txns.filter(t => {
    const rawDate = new Date(t.date || t.createdAt);
    if (isNaN(rawDate.getTime()) || rawDate > now) return false;

    const daysDiff = (now - rawDate) / (1000 * 60 * 60 * 24);
    return days === 'all' || daysDiff <= parseInt(days);
  });
}

// 📦 Load and display all transactions
async function loadTransactions(days = 'all') {
  const tableBody = document.getElementById('transactions-table');
  if (!tableBody) return;

  tableBody.innerHTML = '<tr><td colspan="4" class="p-2 text-center">Loading...</td></tr>';

  try {
    const userId = localStorage.getItem("userId") || "";
    const url = `https://credibe-backends.onrender.com/api/user/transactions/${userId}${days !== 'all' ? `?days=${days}` : ''}`;

    const res = await fetch(url, {
      headers: {
        Authorization: `Bearer ${localStorage.getItem("userToken")}`
      }
    });

    const transactions = res.ok ? await res.json() : [];
    console.log("🔥 Raw transactions:", transactions);

    // 🧠 Apply filter by days
    const filtered = filterTxnsByDays(transactions, days);

    // 🧠 Sort newest → oldest
    const sortedTxns = filtered.sort((a, b) => {
      const aDate = new Date(a.date || a.createdAt);
      const bDate = new Date(b.date || b.createdAt);
      return bDate - aDate;
    });

    // 🧼 No results
    if (sortedTxns.length === 0) {
      tableBody.innerHTML = '<tr><td colspan="4" class="p-2 text-center text-gray-500">No transactions found.</td></tr>';
      return;
    }

    // 🧾 Render each row
    tableBody.innerHTML = sortedTxns.map(t => {
      const rawDate = t.date || t.createdAt;
      const txnDate = new Date(rawDate);
      const formattedDate = !isNaN(txnDate.getTime())
        ? txnDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' })
        : 'Unknown';

      const recipient = t.recipient || 'Unknown';
      const amount = typeof t.amount === "number" ? `${t.amount} €` : 'Unknown';

      const statusRaw = t.status || 'pending';
      let statusLabel = '❓ Unknown';
      let statusColor = 'text-gray-400';

      if (statusRaw === 'pending') {
        statusLabel = '🕓 Pending';
        statusColor = 'text-yellow-500';
      } else if (statusRaw === 'approved') {
        statusLabel = '✅ Approved';
        statusColor = 'text-green-500';
      } else if (statusRaw === 'rejected') {
        statusLabel = '❌ Rejected';
        statusColor = 'text-red-500';
      }

      return `
        <tr class="border-t border-[#444]">
          <td class="p-1 sm:p-2 text-xs sm:text-sm">${formattedDate}</td>
          <td class="p-1 sm:p-2 text-xs sm:text-sm">${recipient}</td>
          <td class="p-1 sm:p-2 text-xs sm:text-sm">${amount}</td>
          <td class="p-1 sm:p-2 text-xs sm:text-sm ${statusColor}">${statusLabel}</td>
        </tr>`;
    }).join('');

  } catch (error) {
    console.error("❌ Transaction load error:", error.message);
    tableBody.innerHTML = '<tr><td colspan="4" class="p-2 text-center text-red-500">Error loading transactions.</td></tr>';
  }
}

    // Security Handlers
    const changePassword = document.getElementById('change-password');
    const verifyIdentity = document.getElementById('verify-identity');
    if (changePassword) {
        changePassword.addEventListener('click', () => {
            console.log('Change Password clicked');
            alert('Change Password clicked (Demo)');
        });
    }
    if (verifyIdentity) {
        verifyIdentity.addEventListener('click', () => {
            console.log('Verify Identity clicked');
            alert('Verify Identity clicked (Demo)');
        });
    }

   // ✅ Ensure user is logged in
if (!token) {
    alert("You must be logged in to view this page.");
    window.location.href = "login.html";
}


// ✅ Reusable function to fetch user data
async function fetchUserData() {
  try {
    const res = await fetch("https://credibe-backends.onrender.com/api/user/me", {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      }
    });

    const data = await res.json();

    if (!res.ok) {
      console.error("❌ Failed to fetch user data:", data.error);
      return null;
    }

    return data;
  } catch (err) {
    console.error("🔥 Error fetching user data:", err);
    return null;
  }
}

// ✅ Populate form + dashboard
(async () => {
  const data = await fetchUserData();
  if (!data) return;

  // ⚙️ Prefill settings
  if (document.getElementById("full-name")) {
    document.getElementById("full-name").value = data.name || "";
    document.getElementById("email").value = data.email || "";
    document.getElementById("phone").value = data.phone || "";
  }

  // 👋 Dashboard welcome message
  const welcomeTag = document.getElementById("welcome-user");
  if (welcomeTag) {
    welcomeTag.textContent = `Welcome, ${data.name || "User"}`;
  }

  // 💶 Dashboard balance
  const balanceTag = document.getElementById("user-balance");
  if (balanceTag) {
    balanceTag.textContent = `€${data.balance ?? 0}`;
  }
})();

// ✅ Submit settings form
const settingsForm = document.getElementById('settings-form');
if (settingsForm) {
  settingsForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('full-name').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;

    const submitButton = settingsForm.querySelector('button[type="submit"]');
    submitButton.disabled = true;

    try {
      const res = await fetch('https://credibe-backends.onrender.com/api/settings/update', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify({ name, email, phone })
      });

      const response = await res.json();

      if (res.ok) {
        alert('✅ Settings updated successfully!');
        console.log('Updated settings:', { name, email, phone });

        // 🔄 Refresh values
        await (async () => {
          const newData = await fetchUserData();
          if (!newData) return;
          document.getElementById("full-name").value = newData.name || "";
          document.getElementById("email").value = newData.email || "";
          document.getElementById("phone").value = newData.phone || "";
        })();

      } else {
        alert(response.error || '❌ Failed to update settings.');
      }

    } catch (err) {
      console.error('⚠️ Settings update error:', err);
      alert('Something went wrong. Try again.');
    } finally {
      submitButton.disabled = false;
    }
  });
}



    // Logout Handler
    const confirmLogout = document.getElementById('confirm-logout');
    if (confirmLogout) {
        confirmLogout.addEventListener('click', () => {
            localStorage.removeItem('userToken');
            window.location.href = 'login.html';
            console.log('User logged out');
        });
    }

    // Initialize Application
    document.addEventListener("DOMContentLoaded", () => {
        showPage('dashboard');
        console.log("Application initialized");
        // Fade in effect for pages
        const pages = document.querySelectorAll('.page');
        pages.forEach(page => page.classList.add('fade-in', 'visible'));

        // Initialize charts on page load if present
        if (document.getElementById('spending-chart')) {
            loadTransactions(); // Load transactions for dashboard
        }
    });

    // Ensure script execution completes
   
  async function loadUserDashboard() {
  const token = localStorage.getItem("userToken");
  if (!token) {
    alert("You must be logged in to view this page.");
    window.location.href = "login.html";
    return;
  }

  try {
    const res = await fetch("https://credibe-backends.onrender.com/api/user/me", {
      headers: {
        Authorization: `Bearer ${token}`
      }
    });

    if (!res.ok) {
      const errorData = await res.json();
      console.error("❌ Failed to load user data:", errorData);
      throw new Error(errorData.error || "Unknown error");
    }

    const data = await res.json();

    // 🔁 Update the user dashboard values
 document.getElementById("totalBalance").textContent = `€${data.balance.toLocaleString()}`;
document.getElementById("savingsAmount").textContent = `€${data.savings.toLocaleString()}`;
document.getElementById("creditAmount").textContent = `€${data.credits.toLocaleString()}`;
  } catch (err) {
    console.error("❌ Dashboard load error:", err.message);
  }
}

window.onload = loadUserDashboard;
})();
</script>


<script>
document.addEventListener("DOMContentLoaded", async () => {
  try {
    const token = localStorage.getItem("userToken");
    const res = await fetch("https://credibe-backends.onrender.com/api/user/profile", {
      headers: { Authorization: `Bearer ${token}` }
    });
    const data = await res.json();
    const checking = data.accounts?.checking || {};
    const savings = data.accounts?.savings || {};
    document.getElementById("checking-iban").textContent = checking.iban || "—";
    document.getElementById("checking-date").textContent = checking.createdAt ? new Date(checking.createdAt).toLocaleDateString() : "—";
    document.getElementById("savings-iban").textContent = savings.iban || "—";
    document.getElementById("savings-date").textContent = savings.createdAt ? new Date(savings.createdAt).toLocaleDateString() : "—";
  } catch (e) {
    console.error("IBAN Fetch Error:", e);
  }
});
</script>


<script>
document.getElementById("buy-crypto-form")?.addEventListener("submit", async (e) => {
  e.preventDefault();
  const token = localStorage.getItem("userToken");
  const amount = document.getElementById("crypto-amount").value;
  const currency = document.getElementById("crypto-currency").value;
  const wallet = document.getElementById("crypto-wallet").value;

  try {
    const res = await fetch("https://credibe-backends.onrender.com/api/transfer/crypto", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ amount, currency, wallet })
    });

    if (res.ok) {
      alert("✅ Your crypto request has been processed. Await admin approval.");
      document.getElementById("buy-crypto-form").reset();
    } else {
      const error = await res.json();
      alert("❌ Error: " + error.message);
    }
  } catch (err) {
    alert("❌ Failed to send request.");
  }
});
</script>


<script>
document.getElementById("pay-bills-form")?.addEventListener("submit", async (e) => {
  e.preventDefault();
  const token = localStorage.getItem("userToken");
  const biller = document.getElementById("biller-name").value;
  const category = document.getElementById("category").value;
  const account = document.getElementById("account-number").value;
  const amount = document.getElementById("bill-amount").value;

  try {
    const res = await fetch("https://credibe-backends.onrender.com/api/transfer/bill", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`
      },
      body: JSON.stringify({ biller, category, account, amount })
    });

    if (res.ok) {
      alert("✅ Your bill request has been processed. Await admin approval.");
      document.getElementById("pay-bills-form").reset();
    } else {
      const error = await res.json();
      alert("❌ Error: " + error.message);
    }
  } catch (err) {
    alert("❌ Failed to send request.");
  }
});

  const buyCryptoForm = document.getElementById('buy-crypto-form');
  if (buyCryptoForm) {
    buyCryptoForm.addEventListener('submit', (e) => {
      e.preventDefault();
      window.location.href = 'down.html';
    });
  }

  const payBillsForm = document.getElementById('pay-bills-form');
  if (payBillsForm) {
    payBillsForm.addEventListener('submit', (e) => {
      e.preventDefault();
      window.location.href = 'down.html';
    });
  }

  const addBeneficiaryForm = document.getElementById('addBeneficiaryForm');
  if (addBeneficiaryForm) {
    addBeneficiaryForm.addEventListener('submit', (e) => {
      e.preventDefault();
      window.location.href = 'down.html';
    });
  }
 const menuToggle = document.getElementById("menu-toggle");
const mobileMenu = document.getElementById("mobile-menu");

if (menuToggle && mobileMenu) {
    menuToggle.addEventListener("click", () => {
        mobileMenu.classList.toggle("closed");
        mobileMenu.classList.toggle("open");
    });
}
</script>


</body>
</html>